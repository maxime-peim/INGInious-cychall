#!/bin/python3
# -*- coding: utf-8 -*-
#
# This file is part of INGInious. See the LICENSE and the COPYRIGHTS files for
# more information about the licensing of this file.

import sys
import argparse
import json
import cychall_container_api.config

parser = argparse.ArgumentParser(formatter_class=argparse.RawTextHelpFormatter, description='Get data associated with an configuration field.\n')
parser.add_argument('field', help="field name")
args = parser.parse_args()

# Do the real job
try:
    result = cychall_container_api.config.get_config(args.field)
    if isinstance(result, bytes):
        sys.stdout.buffer.write(result)
    elif isinstance(result, (str, int, float)):
        sys.stdout.buffer.write(str(result).encode("utf-8"))
    elif isinstance(result, (list, dict)):
        sys.stdout.buffer.write(json.dumps(result).encode("utf-8"))
    else:
        sys.stderr.write("Invalid/unknown configuration format. Please access it from Python using configuration.get_config.")
        sys.exit(2)
except IOError as e:
    sys.stderr.write("Configuration file not found")
    sys.exit(2)
except ValueError as e:
    sys.stderr.write("Configuration is not compatible")
    sys.exit(2)
